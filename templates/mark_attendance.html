<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mark Attendance</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
<div class="container py-5">
  <div class="card mx-auto shadow" style="max-width:480px;">
    <div class="card-body">

      <h4 class="card-title mb-3 text-center">
        Attendance for {{ subject }} - Class {{ class_id }}
      </h4>

      {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
      {% endif %}

      <form method="POST" id="attendanceForm">

        <div class="mb-3">
          <label class="form-label">Student Name</label>
          <input type="text" class="form-control" name="name" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Roll Number</label>
          <input type="text" class="form-control" name="roll" required>
        </div>

        <!-- Hidden location fields -->
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">

        <div id="locationError" class="alert alert-danger d-none">
          Location permission is required to mark attendance.
        </div>

        <button type="button" id="detectLocationBtn"
                class="btn btn-info w-100 mb-3">
          Detect Location
        </button>

        <button type="submit" id="submitBtn"
                class="btn btn-primary w-100" disabled>
          Submit Attendance
        </button>

      </form>
    </div>
  </div>
</div>

<script>
const detectBtn = document.getElementById("detectLocationBtn");
const submitBtn = document.getElementById("submitBtn");
const errorBox = document.getElementById("locationError");
const latInput = document.getElementById("latitude");
const lonInput = document.getElementById("longitude");

submitBtn.disabled = true;

detectBtn.onclick = () => {
  errorBox.classList.add("d-none");

  if (!navigator.geolocation) {
    alert("Geolocation is not supported by your browser.");
    return;
  }

  detectBtn.disabled = true;
  detectBtn.innerText = "Detecting location...";

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      latInput.value = pos.coords.latitude;
      lonInput.value = pos.coords.longitude;

      submitBtn.disabled = false;
      detectBtn.disabled = false;
      detectBtn.innerText = "Location Detected âœ“";
    },
    () => {
      detectBtn.disabled = false;
      detectBtn.innerText = "Detect Location";
      submitBtn.disabled = true;
      errorBox.classList.remove("d-none");
    },
    { enableHighAccuracy: true, timeout: 10000 }
  );
};
</script>

</body>
</html>
